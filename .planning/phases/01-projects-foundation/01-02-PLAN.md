---
phase: 01-projects-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/routes.tsx
  - src/pages/App/Project/ProjectSelectorList.tsx
  - src/pages/App/Project/ProjectSelectorItem.tsx
  - src/pages/App/AppSidebar.tsx
  - shared/types/routes.ts
autonomous: true

must_haves:
  truths:
    - "Project routes exist at /workspaces/:workspaceId/projects/*"
    - "Projects section appears in sidebar below Channels"
    - "Clicking a project navigates to its detail page"
    - "Create project button (+) appears in sidebar Projects header"
    - "Projects display with color dot and name, sorted alphabetically"
  artifacts:
    - path: "src/routes.tsx"
      provides: "Project route definitions"
      contains: "projects"
    - path: "src/pages/App/Project/ProjectSelectorList.tsx"
      provides: "Sidebar project list component"
      min_lines: 30
    - path: "src/pages/App/Project/ProjectSelectorItem.tsx"
      provides: "Individual project item in sidebar"
      min_lines: 20
    - path: "src/pages/App/AppSidebar.tsx"
      provides: "Integrated ProjectSelectorList"
      contains: "ProjectSelectorList"
  key_links:
    - from: "src/pages/App/Project/ProjectSelectorList.tsx"
      to: "api.projects.listByUserMembership"
      via: "useQuery hook"
      pattern: "useQuery\\(api\\.projects\\.listByUserMembership"
    - from: "src/pages/App/AppSidebar.tsx"
      to: "src/pages/App/Project/ProjectSelectorList.tsx"
      via: "component import and render"
      pattern: "<ProjectSelectorList"
---

<objective>
Add project routes and integrate the Projects section into the sidebar with navigation support.

Purpose: Enable users to see and navigate to projects from the sidebar. This wires up the backend from Plan 01 to the navigation layer.

Output: Working sidebar Projects section that lists user's projects and navigates to project pages.
</objective>

<execution_context>
@/home/lambda/.claude/get-shit-done/workflows/execute-plan.md
@/home/lambda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-projects-foundation/01-CONTEXT.md
@.planning/phases/01-projects-foundation/01-01-SUMMARY.md

# Key reference files (existing patterns to follow)
@src/routes.tsx
@src/pages/App/AppSidebar.tsx
@src/pages/App/Channel/ChannelSelectorList.tsx
@src/pages/App/Channel/ChannelSelectorItem.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add project routes to routes.tsx</name>
  <files>
    src/routes.tsx
    shared/types/routes.ts
  </files>
  <action>
1. In `src/routes.tsx`, add project routes nested under workspaces/:workspaceId:
   ```typescript
   {
     path: "projects",
     children: [
       {
         index: true,
         element: <Projects />,  // List view (placeholder for now)
       },
       {
         path: ":projectId",
         element: <ProjectDetails />,
       },
       {
         path: ":projectId/settings",
         element: <ProjectSettings />,
       },
     ],
   },
   ```

2. Add imports at top of file (components will be created in later plans):
   ```typescript
   import { ProjectDetails } from "./pages/App/Project/ProjectDetails";
   import { ProjectSettings } from "./pages/App/Project/ProjectSettings";
   import { Projects } from "./pages/App/Project/Projects";
   ```

3. Create placeholder components so routes don't break:
   - Create `src/pages/App/Project/Projects.tsx` with simple "Projects" text
   - Create `src/pages/App/Project/ProjectDetails.tsx` with simple "Project Details" text
   - Create `src/pages/App/Project/ProjectSettings.tsx` with simple "Project Settings" text

   These are minimal placeholders - just export a component that returns a div with the page name.

4. In `shared/types/routes.ts`, add projectId to QueryParams if it doesn't already include it:
   ```typescript
   export type QueryParams = {
     workspaceId: string;
     channelId?: string;
     documentId?: string;
     diagramId?: string;
     projectId?: string;  // Add this
   };
   ```

Place the projects routes BEFORE documents in the children array (order: channels, projects, documents, diagrams).
  </action>
  <verify>
    Run `npm run lint` - no errors
    Navigate to /workspaces/{id}/projects in browser - should show placeholder
  </verify>
  <done>
    Routes exist: /projects, /projects/:projectId, /projects/:projectId/settings
    Placeholder components created for each route
    QueryParams includes projectId
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ProjectSelectorList and ProjectSelectorItem components</name>
  <files>
    src/pages/App/Project/ProjectSelectorList.tsx
    src/pages/App/Project/ProjectSelectorItem.tsx
  </files>
  <action>
1. Create `src/pages/App/Project/ProjectSelectorList.tsx` following ChannelSelectorList pattern:
   ```typescript
   import { useQuery } from "convex/react";
   import { FolderPlus } from "lucide-react";
   import { useState } from "react";
   import { api } from "../../../../convex/_generated/api";
   import { Id } from "../../../../convex/_generated/dataModel";
   import {
     SidebarGroup,
     SidebarGroupAction,
     SidebarGroupLabel,
     SidebarMenu,
   } from "../../../components/ui/sidebar";
   import { ProjectSelectorItem } from "./ProjectSelectorItem";
   import { CreateProjectDialog } from "./CreateProjectDialog";

   export interface ProjectSelectorListProps {
     workspaceId: Id<"workspaces">;
     projectId: Id<"projects"> | undefined;
     onProjectSelect: (id: string | null) => void;
     onManageProject: (id: string) => void;
   }

   export function ProjectSelectorList({
     workspaceId,
     projectId,
     onProjectSelect,
     onManageProject,
   }: ProjectSelectorListProps) {
     const [showCreateProject, setShowCreateProject] = useState(false);

     const projects = useQuery(api.projects.listByUserMembership, {
       workspaceId,
     });

     return (
       <SidebarGroup className="group-data-[collapsible=icon]:hidden">
         <SidebarGroupLabel>Projects</SidebarGroupLabel>
         <SidebarGroupAction
           title="Create project"
           onClick={() => setShowCreateProject(true)}
         >
           <FolderPlus />
           <span className="sr-only">Create project</span>
         </SidebarGroupAction>
         <SidebarMenu>
           {projects?.map((project) => (
             <ProjectSelectorItem
               key={project._id}
               project={project}
               projectId={projectId}
               onProjectSelect={onProjectSelect}
               onManageProject={onManageProject}
             />
           ))}
         </SidebarMenu>
         <CreateProjectDialog
           workspaceId={workspaceId}
           open={showCreateProject}
           onOpenChange={setShowCreateProject}
         />
       </SidebarGroup>
     );
   }
   ```

2. Create `src/pages/App/Project/ProjectSelectorItem.tsx` following ChannelSelectorItem pattern:
   - Props: project (Doc<"projects">), projectId (current selection), onProjectSelect, onManageProject
   - Render SidebarMenuItem with:
     - SidebarMenuButton showing color dot (small circle with project.color class) + project.name
     - DropdownMenu with actions: "View project", "Settings", separator, "Delete project"
   - Active state: isActive = projectId === project._id
   - Use Folder icon (not MessageSquare like channels)

   Color dot implementation:
   ```typescript
   <span className={`w-2 h-2 rounded-full ${project.color}`} />
   ```

Note: CreateProjectDialog will be created in Plan 03. For now, add the import but the dialog won't render (that's fine - the button will just not work yet).

Actually, create a minimal placeholder CreateProjectDialog.tsx:
```typescript
export function CreateProjectDialog({ workspaceId, open, onOpenChange }: {
  workspaceId: Id<"workspaces">;
  open: boolean;
  onOpenChange: (open: boolean) => void;
}) {
  return null; // Placeholder - implemented in Plan 03
}
```
  </action>
  <verify>
    Run `npm run lint` - no TypeScript errors
    Components compile without errors
  </verify>
  <done>
    ProjectSelectorList.tsx renders Projects section with + button and project list
    ProjectSelectorItem.tsx renders individual project with color dot, name, and dropdown menu
    CreateProjectDialog.tsx placeholder exists (returns null)
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate ProjectSelectorList into AppSidebar</name>
  <files>src/pages/App/AppSidebar.tsx</files>
  <action>
1. Add import at top:
   ```typescript
   import { ProjectSelectorList } from "./Project/ProjectSelectorList";
   ```

2. Extract projectId from useParams (it's already in QueryParams after Task 1):
   ```typescript
   const { workspaceId, channelId, documentId, diagramId, projectId } = useParams<QueryParams>();
   ```

3. Add navigation handlers (following the channel pattern):
   ```typescript
   const handleProjectSelect = (id: string | null) => {
     setOpenMobile(false);
     if (!id) {
       navigate(`/workspaces/${workspaceId}/projects`);
     } else {
       navigate(`/workspaces/${workspaceId}/projects/${id}`);
     }
   };

   const handleManageProject = (id: string) => {
     navigate(`/workspaces/${workspaceId}/projects/${id}/settings`);
   };
   ```

4. Add ProjectSelectorList to SidebarContent, AFTER ChannelSelectorList but BEFORE DocumentSelectorList:
   ```typescript
   <ChannelSelectorList ... />
   <ProjectSelectorList
     workspaceId={workspaceId}
     projectId={projectId}
     onProjectSelect={handleProjectSelect}
     onManageProject={handleManageProject}
   />
   <DocumentSelectorList ... />
   ```

This places Projects section between Channels and Documents in the sidebar, matching the "dedicated Projects section" requirement from CONTEXT.md.
  </action>
  <verify>
    Run `npm run lint` - no errors
    Run `npm run dev` and verify sidebar shows Projects section
  </verify>
  <done>
    ProjectSelectorList appears in sidebar between Channels and Documents
    Clicking project navigates to /workspaces/{id}/projects/{projectId}
    + button triggers create dialog (placeholder for now)
    Dropdown menu shows view/settings/delete options
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run lint` passes
2. `npm run dev` shows Projects section in sidebar
3. Routes work: /projects, /projects/:id, /projects/:id/settings all render placeholders
4. Projects list from API displays in sidebar (will be empty until projects are created)
</verification>

<success_criteria>
- Project routes defined at /workspaces/:workspaceId/projects/*
- ProjectSelectorList renders in sidebar with "Projects" label and + button
- ProjectSelectorItem shows color dot + name for each project
- Dropdown menu has View, Settings, Delete options
- Navigation handlers wire up project selection and settings
- QueryParams type includes projectId
</success_criteria>

<output>
After completion, create `.planning/phases/01-projects-foundation/01-02-SUMMARY.md`
</output>
