---
phase: 02-basic-tasks
plan: 03
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - src/pages/App/Project/TaskDetailSheet.tsx
  - src/pages/App/Project/Tasks.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking a task row opens a side panel (Sheet) sliding in from the right with full task details"
    - "User can edit task title inline in the side panel"
    - "User can edit task description with BlockNote rich text editor"
    - "User can change task status, priority, assignee, and labels from the side panel"
    - "User can delete a task from the side panel with confirmation"
    - "Side panel has an expand button that navigates to a full-page task view"
    - "Changes save automatically (no explicit save button needed for individual property changes)"
  artifacts:
    - path: "src/pages/App/Project/TaskDetailSheet.tsx"
      provides: "Side panel with full task editing capabilities"
      contains: "TaskDetailSheet"
    - path: "src/pages/App/Project/Tasks.tsx"
      provides: "Task list with sheet integration (selectedTaskId state)"
      contains: "TaskDetailSheet"
  key_links:
    - from: "src/pages/App/Project/TaskDetailSheet.tsx"
      to: "convex/tasks.ts"
      via: "useQuery for get, useMutation for update/remove"
      pattern: "api\\.tasks\\.(get|update|remove)"
    - from: "src/pages/App/Project/TaskDetailSheet.tsx"
      to: "convex/taskStatuses.ts"
      via: "useQuery for status list"
      pattern: "api\\.taskStatuses\\.listByWorkspace"
    - from: "src/pages/App/Project/Tasks.tsx"
      to: "src/pages/App/Project/TaskDetailSheet.tsx"
      via: "Sheet rendered with selectedTaskId"
      pattern: "<TaskDetailSheet"
---

<objective>
Build the task detail side panel (Sheet) with full property editing: title, BlockNote description, status, priority, assignee, labels, and delete. Wire it into the task list so clicking a task opens the panel.

Purpose: This is where users do detailed task work. The side panel is the primary editing surface for all task properties including rich text descriptions.
Output: Fully functional task detail panel that slides in from right, with inline editing for all properties.
</objective>

<execution_context>
@/home/lambda/.claude/get-shit-done/workflows/execute-plan.md
@/home/lambda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-basic-tasks/02-RESEARCH.md
@.planning/phases/02-basic-tasks/02-02-SUMMARY.md

@convex/tasks.ts
@convex/taskStatuses.ts
@src/pages/App/Project/Tasks.tsx
@src/pages/App/Document/DocumentEditor.tsx
@src/components/ui/sheet.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TaskDetailSheet with full property editing</name>
  <files>src/pages/App/Project/TaskDetailSheet.tsx</files>
  <action>
    Create `src/pages/App/Project/TaskDetailSheet.tsx`:

    **Props:**
    - `taskId: Id<"tasks"> | null` — the task to display (null when closed)
    - `open: boolean` — controls sheet visibility
    - `onOpenChange: (open: boolean) => void` — callback when sheet closes
    - `workspaceId: Id<"workspaces">` — needed for status list and member queries
    - `projectId: Id<"projects">` — needed for navigation to full page

    **Data loading:**
    - `useQuery(api.tasks.get, taskId ? { taskId } : "skip")` — task details
    - `useQuery(api.taskStatuses.listByWorkspace, { workspaceId })` — available statuses for dropdown
    - `useQuery(api.projectMembers.membersByProject, { projectId })` — available assignees (project members)
    - Note: membersByProject should return user data. Check the existing projectMembers.ts to see what it returns. If it only returns membership records, you may need to enrich with user data or use a separate user query.
    - `useMutation(api.tasks.update)` — for property changes
    - `useMutation(api.tasks.remove)` — for deletion

    **Layout (Sheet sliding from right, w-[600px] sm:w-[540px]):**

    A. **Header section:**
    - Title: render as an editable input (not a heading). Use a borderless Input that looks like a heading (text-lg font-semibold, border-none focus:ring-0). On blur or Enter, call update mutation with new title.
    - Action buttons (top right): Expand button (Maximize2 icon, navigates to `/workspaces/:workspaceId/projects/:projectId/tasks/:taskId`), Delete button (Trash2 icon, shows confirmation dialog).

    B. **Properties section (grid layout, 2 columns: label + value):**
    - **Status:** Select dropdown populated from taskStatuses query. Show colored dot + name. On change, call update with new statusId.
    - **Priority:** Select dropdown with 4 options (urgent/high/medium/low). Show priority icon + label. On change, call update with new priority.
    - **Assignee:** Select dropdown populated from project members. Show avatar + name. Include "Unassigned" option. On change, call update with new assigneeId (or undefined for unassigned).
    - **Labels:** Simple tag input. Show existing labels as small badges. Input field to type new label + Enter to add. Click X on badge to remove. On change, call update with new labels array. Use freeform strings (no predefined list).

    C. **Description section:**
    - Heading: "Description" with muted text
    - BlockNote editor for rich text. Follow the pattern from the existing Document editor:
      - Use `useCreateBlockNote` with `initialContent` from task.description (JSON.parse if exists, undefined if not)
      - Use `BlockNoteView` from `@blocknote/shadcn`
      - On content change: debounce (500ms) and call update mutation with `description: JSON.stringify(editor.document)`
      - Import BlockNote CSS: `@blocknote/core/fonts/inter.css` and `@blocknote/shadcn/style.css`
    - Placeholder when empty: "Add a description..."
    - The editor should be a reasonable height (min-h-[200px]) but grow with content

    D. **Delete confirmation:**
    - Use AlertDialog (from shadcn, should already exist) or a simple confirm pattern
    - Message: "Delete this task? This action cannot be undone."
    - On confirm: call remove mutation, close sheet
    - On cancel: dismiss

    **Auto-save pattern:** Each property change immediately calls the update mutation. No form submission needed. This gives instant feedback via Convex reactivity. Debounce only the description (BlockNote) changes to avoid excessive writes during typing.

    **Loading state:** While task query is loading (undefined), show skeleton content or spinner inside the sheet.
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint`. Verify BlockNote imports resolve correctly (check existing DocumentEditor for exact import paths).</verify>
  <done>TaskDetailSheet renders with editable title, status/priority/assignee/label selectors, BlockNote description editor, and delete with confirmation. All property changes auto-save via mutations.</done>
</task>

<task type="auto">
  <name>Task 2: Wire TaskDetailSheet into Tasks.tsx with routing for full page</name>
  <files>src/pages/App/Project/Tasks.tsx, src/routes.tsx</files>
  <action>
    1. Update `src/pages/App/Project/Tasks.tsx`:
    - Import TaskDetailSheet
    - The `selectedTaskId` state should already exist from Plan 02. If not, add it: `const [selectedTaskId, setSelectedTaskId] = useState<Id<"tasks"> | null>(null)`
    - Add `open` state derived from selectedTaskId: `const sheetOpen = selectedTaskId !== null`
    - Wire TaskRow onClick: `onClick={() => setSelectedTaskId(task._id)}`
    - Render TaskDetailSheet at the bottom of the component:
      ```tsx
      <TaskDetailSheet
        taskId={selectedTaskId}
        open={sheetOpen}
        onOpenChange={(open) => { if (!open) setSelectedTaskId(null); }}
        workspaceId={workspaceId}
        projectId={projectId}
      />
      ```
    - Ensure workspaceId is available (from route params or passed as prop). Check how ProjectDetails passes data — may need to thread workspaceId through.

    2. Add task full-page route to `src/routes.tsx` (for the expand button):
    - Add a route under the projects/:projectId path:
      ```
      {
        path: ":projectId/tasks/:taskId",
        element: <TaskDetailPage />,
      }
      ```
    - Create a simple `TaskDetailPage.tsx` component that renders the task detail in full-page layout (not in a sheet). This can be a minimal wrapper that renders the same editing UI but in a full-page container instead of a Sheet. For now, it can be a placeholder that shows the task detail content directly (reuse the internals of TaskDetailSheet without the Sheet wrapper, or just render TaskDetailSheet content in a div).
    - Alternative simpler approach: The expand button can just navigate to the task's project page with the task pre-selected. But per user decision, side panel should have an "expand" option. A full-page task view is the expand target. Keep it simple for now — a basic page that shows task properties is sufficient.

    3. If TaskDetailPage is created, add it to files list and import in routes.tsx.
  </action>
  <verify>
    Run `npm run lint` and `npx tsc --noEmit`. Start dev server and verify:
    - Clicking a task row opens the side panel
    - Closing the sheet (click outside or X) deselects the task
    - Editing a property in the sheet updates the task in the list
    - The expand button navigates to the full-page route
  </verify>
  <done>Clicking a task opens the detail sheet. Properties are editable in the sheet. Expand button navigates to full-page task view. Sheet closes cleanly. Changes reflect in the task list in real-time.</done>
</task>

</tasks>

<verification>
1. `npm run lint` passes
2. `npx tsc --noEmit` passes
3. Clicking task row opens Sheet from right with task details
4. Title is editable inline (borderless input)
5. Status, priority, assignee dropdowns work and save immediately
6. Labels can be added/removed as freeform strings
7. BlockNote description editor loads and saves content
8. Delete shows confirmation, then removes task
9. Expand button navigates to full-page task view
10. Sheet closes when clicking outside or pressing X
</verification>

<success_criteria>
- User can click any task to see full details in side panel
- User can edit title, description (rich text), status, priority, assignee, and labels
- User can delete a task with confirmation
- Changes auto-save without explicit save button
- Side panel has expand option to full page
- No lint or type errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-basic-tasks/02-03-SUMMARY.md`
</output>
