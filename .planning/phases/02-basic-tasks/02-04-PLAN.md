---
phase: 02-basic-tasks
plan: 04
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - src/pages/App/Project/MyTasks.tsx
  - src/pages/App/AppSidebar.tsx
  - src/routes.tsx
autonomous: true

must_haves:
  truths:
    - "User can access My Tasks from the sidebar as a dedicated page"
    - "My Tasks shows all tasks assigned to the current user across all projects in the workspace"
    - "Tasks are grouped by project with collapsible sections"
    - "Clicking a task in My Tasks opens the detail side panel in-place (does not navigate away)"
    - "Completed tasks are hidden by default with a toggle to show them"
  artifacts:
    - path: "src/pages/App/Project/MyTasks.tsx"
      provides: "Cross-project task view grouped by project"
      contains: "MyTasks"
    - path: "src/pages/App/AppSidebar.tsx"
      provides: "My Tasks link in sidebar"
      contains: "My Tasks"
  key_links:
    - from: "src/pages/App/Project/MyTasks.tsx"
      to: "convex/tasks.ts"
      via: "useQuery for listByAssignee"
      pattern: "api\\.tasks\\.listByAssignee"
    - from: "src/pages/App/Project/MyTasks.tsx"
      to: "src/pages/App/Project/TaskDetailSheet.tsx"
      via: "TaskDetailSheet for in-place task editing"
      pattern: "<TaskDetailSheet"
    - from: "src/pages/App/AppSidebar.tsx"
      to: "src/pages/App/Project/MyTasks.tsx"
      via: "sidebar navigation link"
      pattern: "my-tasks|My Tasks"
---

<objective>
Build the My Tasks cross-project view showing all tasks assigned to the current user, grouped by project with collapsible sections, and add it to the sidebar navigation.

Purpose: Users need a single place to see everything assigned to them across all projects. This is the personal productivity hub.
Output: My Tasks page accessible from sidebar, showing grouped tasks with in-place detail editing.
</objective>

<execution_context>
@/home/lambda/.claude/get-shit-done/workflows/execute-plan.md
@/home/lambda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-basic-tasks/02-RESEARCH.md
@.planning/phases/02-basic-tasks/02-02-SUMMARY.md

@convex/tasks.ts
@src/pages/App/AppSidebar.tsx
@src/pages/App/Project/TaskRow.tsx
@src/pages/App/Project/TaskDetailSheet.tsx
@src/routes.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MyTasks page with project-grouped task list</name>
  <files>src/pages/App/Project/MyTasks.tsx</files>
  <action>
    Create `src/pages/App/Project/MyTasks.tsx`:

    **Data:**
    - Get workspaceId from route params (useParams)
    - `useQuery(api.tasks.listByAssignee, { workspaceId, hideCompleted })` — returns tasks enriched with project, status, assignee data
    - Group tasks by projectId client-side: use `Object.groupBy` or a reduce to create `Map<projectId, task[]>` groups. Each group needs the project name (available from enriched task data).

    **Layout:**

    A. **Page header:**
    - Title: "My Tasks" (text-2xl font-bold)
    - Subtitle: "Tasks assigned to you across all projects" (text-muted-foreground)
    - Hide completed toggle: same pattern as Tasks.tsx (Checkbox or text button)
    - Task count: total number of visible tasks

    B. **Grouped task list:**
    - For each project group:
      - Collapsible section header: project color dot + project name + task count in parentheses
      - Use shadcn Collapsible component (or simple state toggle with ChevronDown/ChevronRight icon)
      - Default: all sections expanded
      - Inside each section: render TaskRow components for each task in that group
      - TaskRow onClick: set selectedTaskId (opens detail sheet in-place)

    C. **TaskDetailSheet:**
    - Render TaskDetailSheet at the bottom of the page (same pattern as Tasks.tsx)
    - When a task is selected, the sheet opens with that task's details
    - The sheet needs workspaceId and the task's projectId. Since the selected task may be from any project, pass the projectId from the selected task's data.
    - User stays on My Tasks page when editing — does NOT navigate to the project page

    D. **Empty state:**
    - When no tasks are assigned to user:
      - Icon: `CheckSquare` (muted)
      - Text: "No tasks assigned to you"
      - Subtext: "Tasks assigned to you will appear here"

    E. **Loading state:**
    - While query is loading: show skeleton or "Loading..." content

    **Project grouping logic:**
    ```typescript
    // Group tasks by projectId
    const groupedTasks = useMemo(() => {
      if (!tasks) return [];
      const groups = new Map<string, { projectName: string; projectColor: string; projectId: string; tasks: typeof tasks }>();
      for (const task of tasks) {
        const key = task.projectId;
        if (!groups.has(key)) {
          groups.set(key, {
            projectName: task.project.name,
            projectColor: task.project.color,
            projectId: key,
            tasks: [],
          });
        }
        groups.get(key)!.tasks.push(task);
      }
      return Array.from(groups.values());
    }, [tasks]);
    ```
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run lint`.</verify>
  <done>MyTasks page renders tasks grouped by project with collapsible sections, hide-completed toggle, empty state, and in-place TaskDetailSheet for editing.</done>
</task>

<task type="auto">
  <name>Task 2: Add My Tasks to sidebar and routing</name>
  <files>src/pages/App/AppSidebar.tsx, src/routes.tsx</files>
  <action>
    1. Update `src/routes.tsx`:
    - Import MyTasks: `import { MyTasks } from "./pages/App/Project/MyTasks";`
    - Add route under `workspaces/:workspaceId` children, BEFORE the projects section:
      ```
      {
        path: "my-tasks",
        element: <MyTasks />,
      },
      ```

    2. Update `src/pages/App/AppSidebar.tsx`:
    - Add a "My Tasks" link in the sidebar, positioned ABOVE the Channels section (it's a personal productivity shortcut, not under any section)
    - Use the existing sidebar patterns. Look at how other items are rendered.
    - The link should be:
      - Icon: `CheckSquare` from lucide-react
      - Text: "My Tasks"
      - URL: `/workspaces/${workspaceId}/my-tasks`
      - Active state: highlight when current route matches `/my-tasks`
    - Implementation: Add a simple sidebar item (not a collapsible group) above the ChannelSelectorList:
      ```tsx
      <SidebarMenuButton
        onClick={() => navigate(`/workspaces/${workspaceId}/my-tasks`)}
        isActive={location.pathname.includes('/my-tasks')}
      >
        <CheckSquare className="h-4 w-4" />
        <span>My Tasks</span>
      </SidebarMenuButton>
      ```
    - Check existing sidebar component structure to match the exact pattern. If there's a SidebarMenu wrapping items, use that. The sidebar likely uses SidebarMenuButton or similar patterns — match them exactly.
    - Note: The sidebar ordering per decisions is Channels > Projects > Documents > Diagrams. My Tasks is a personal shortcut that goes above all sections (it's not a section itself, it's a quick link).
  </action>
  <verify>
    Run `npm run lint` and `npx tsc --noEmit`. Start dev server and verify:
    - "My Tasks" link appears in sidebar above channel list
    - Clicking it navigates to the My Tasks page
    - My Tasks page loads and shows tasks (or empty state)
    - Clicking a task in My Tasks opens the detail sheet in-place
  </verify>
  <done>My Tasks is accessible from sidebar with CheckSquare icon. Route renders MyTasks page. Navigation works. User can view and edit their tasks across projects without leaving the My Tasks page.</done>
</task>

</tasks>

<verification>
1. `npm run lint` passes
2. `npx tsc --noEmit` passes
3. "My Tasks" link visible in sidebar above section lists
4. Navigating to My Tasks shows tasks grouped by project
5. Project groups are collapsible with color dot and name
6. Clicking a task opens TaskDetailSheet in-place on the My Tasks page
7. Hide completed toggle works
8. Empty state shows when no tasks assigned
9. Does not navigate away from My Tasks when editing a task
</verification>

<success_criteria>
- User can access My Tasks from sidebar
- Tasks grouped by project with collapsible sections
- Clicking a task opens detail side panel in-place (stays on My Tasks)
- Completed tasks hidden by default with toggle
- Empty state when no assigned tasks
- No lint or type errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-basic-tasks/02-04-SUMMARY.md`
</output>
