---
phase: 03.1-default-taskstatus-logic
plan: 01
subsystem: database
tags: [convex, task-statuses, projects, tasks, seeding, completed-sync]

# Dependency graph
requires:
  - phase: 01-projects-foundation
    provides: projects.create mutation and projectMembers table
  - phase: 02-basic-tasks
    provides: tasks table and taskStatuses table schema
provides:
  - Idempotent default status seeding in projects.create
  - Simplified tasks.create with default status fetch (no lazy seeding)
  - One-way completed field sync (only auto-set true, never auto-reset false)
affects: [03-kanban-board-view, task-status-management, task-completion-flows]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Idempotent seeding pattern with existingStatus check
    - One-way sync pattern for denormalized boolean fields

key-files:
  created: []
  modified:
    - convex/projects.ts
    - convex/tasks.ts

key-decisions:
  - "Default statuses seeded at project creation (workspace-scoped, idempotent)"
  - "One-way completed sync: moving TO Done sets completed=true, moving OUT does not reset"
  - "User must explicitly uncomplete tasks that move out of Done status"

patterns-established:
  - "Idempotent seeding: check for existing records before inserting defaults"
  - "One-way denormalization: only sync derived field in one direction to preserve user intent"

# Metrics
duration: 2.5min
completed: 2026-02-10
---

# Phase 03.1 Plan 01: Default TaskStatus Logic Summary

**Idempotent default status seeding at project creation with one-way completed field sync (Done → true only)**

## Performance

- **Duration:** 2.5 min
- **Started:** 2026-02-10T14:04:46Z
- **Completed:** 2026-02-10T14:07:18Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- Moved default status seeding from tasks.create to projects.create (workspace-scoped, idempotent)
- Simplified tasks.create to fetch default status instead of lazy-seeding (removed 52 lines)
- Fixed completed field sync to be one-way: only auto-set true when moving TO Done, never auto-reset false
- All changes validated with lint (0 errors, 0 warnings) and Convex dev deployment

## Task Commits

Each task was committed atomically:

1. **Task 1: Seed default statuses in projects.create and simplify tasks.create** - `16c67b8` (feat)

Task 2 was verification-only (Convex dev deployment) - no code changes required.

## Files Created/Modified
- `convex/projects.ts` - Added idempotent default status seeding after projectMembers insert (3 statuses: Todo, In Progress, Done)
- `convex/tasks.ts` - Removed lazy-seeding logic (52 lines), simplified to fetch default status with clear error if missing; updated tasks.update and tasks.updatePosition to use one-way completed sync

## Decisions Made

**1. Idempotent seeding at workspace level**
- Statuses are workspace-scoped (not project-scoped)
- First project creation in workspace seeds default statuses
- Subsequent projects in same workspace skip seeding
- Prevents duplicate statuses while allowing multiple projects per workspace

**2. One-way completed sync**
- Moving task TO a completed status (isCompleted=true) auto-sets completed=true
- Moving task OUT of completed status does NOT auto-reset completed to false
- User must explicitly uncomplete the task via UI action
- Preserves user intent when reorganizing completed tasks

**3. Status names normalized**
- Changed "To Do" → "Todo" for consistency
- Maintains default status colors: gray (Todo), blue (In Progress), green (Done)
- Only "Todo" has isDefault=true

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - all code changes applied cleanly, lint passed, build succeeded, Convex deployment validated functions.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Default status logic complete and validated
- Ready for Kanban board view (Phase 03) to use status-based columns
- Ready for status management UI to create custom statuses beyond defaults
- Completed field sync behavior documented for future task completion features

## Self-Check

Verifying all claims from SUMMARY:

**Files exist:**
```
convex/projects.ts - FOUND
convex/tasks.ts - FOUND
```

**Commits exist:**
```
16c67b8 - FOUND
```

**Self-Check: PASSED**

---
*Phase: 03.1-default-taskstatus-logic*
*Completed: 2026-02-10*
